<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swahili Defender Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #4c1d95 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .menu-screen, .game-over-screen {
            text-align: center;
            padding: 40px 20px;
        }
        
        .title {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #fbbf24, #f59e0b, #dc2626);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: pulse 2s infinite;
        }
        
        .subtitle {
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: #bfdbfe;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .feature-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        .feature-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .difficulty-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }
        
        .difficulty-btn.easy { background: #16a34a; }
        .difficulty-btn.normal { background: #2563eb; }
        .difficulty-btn.hard { background: #dc2626; }
        .difficulty-btn.selected { 
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }
        
        .start-btn {
            padding: 20px 60px;
            font-size: 2rem;
            background: linear-gradient(45deg, #16a34a, #2563eb, #7c3aed);
            border: none;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
            margin: 0 20px;
        }
        
        .start-btn:hover {
            transform: scale(1.05);
        }
        
        .game-screen {
            display: none;
        }
        
        .hud {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        
        .hud-left {
            display: flex;
            gap: 30px;
            align-items: center;
        }
        
        .hud-stat {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .game-area {
            position: relative;
            width: 1000px;
            height: 600px;
            margin: 0 auto;
            background: linear-gradient(180deg, rgba(99, 102, 241, 0.3) 0%, rgba(139, 92, 246, 0.2) 50%, rgba(0, 0, 0, 0.6) 100%);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }
        
        .column-label {
            position: absolute;
            top: 20px;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .english-label {
            left: 50px;
            color: #93c5fd;
        }
        
        .swahili-label {
            right: 50px;
            color: #86efac;
        }
        
        .center-divider {
            position: absolute;
            left: 50%;
            top: 0;
            width: 2px;
            height: 100%;
            background: linear-gradient(180deg, #60a5fa, #a78bfa, #f472b6);
            transform: translateX(-50%);
            opacity: 0.6;
        }
        
        .center-vs {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 30px;
            height: 30px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translate(-50%, -50%);
            color: #7c3aed;
            font-weight: bold;
        }
        
        .falling-word {
            position: absolute;
            padding: 15px 20px;
            border-radius: 15px;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            transform: translate(-50%, -50%) scale(1.05);
            transition: all 0.2s;
        }
        
        .english-word {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(29, 78, 216, 0.9));
            border: 2px solid #93c5fd;
        }
        
        .swahili-word {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.9), rgba(21, 128, 61, 0.9));
            border: 2px solid #86efac;
        }
        
        .word-number {
            color: #fde047;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .word-text {
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .word-category {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 4px;
            text-transform: capitalize;
        }
        
        .selected-word {
            transform: translate(-50%, -50%) scale(1.25) !important;
            box-shadow: 0 0 20px #fde047 !important;
        }
        
        .keyboard-status {
            background: rgba(0, 0, 0, 0.4);
            padding: 30px;
            border-radius: 20px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
        }
        
        .input-display {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .input-box {
            flex: 1;
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
        }
        
        .feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2), rgba(220, 38, 38, 0.2));
            border: 2px solid rgba(251, 191, 36, 0.5);
            padding: 20px 40px;
            border-radius: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            backdrop-filter: blur(10px);
            animation: pulse 2s infinite;
            z-index: 1000;
        }
        
        .power-ups {
            display: flex;
            gap: 10px;
        }
        
        .power-up-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .power-up-btn.shield { background: #2563eb; color: white; }
        .power-up-btn.slow { background: #7c3aed; color: white; }
        .power-up-btn.double { background: #eab308; color: black; }
        .power-up-btn.active { animation: pulse 2s infinite; }
        .power-up-btn.cooldown { background: #6b7280; color: #9ca3af; cursor: not-allowed; }
        
        .pause-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            text-align: center;
        }
        
        .particle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
        }
        
        .hidden { display: none; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }
        
        .btn-primary { background: #2563eb; }
        .btn-success { background: #16a34a; }
        .btn-warning { background: #eab308; color: black; }
        .btn-danger { background: #dc2626; }
        
        .btn:hover { transform: translateY(-2px); }
        
        .stats-panel {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            backdrop-filter: blur(10px);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .stat-item {
            display: flex;
            justify-between;
            align-items: center;
            padding: 15px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .achievement-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 8px;
        }
        
        .achievement-unlocked {
            background: rgba(251, 191, 36, 0.2);
            color: #fde047;
        }
        
        .achievement-locked {
            background: rgba(107, 114, 128, 0.1);
            color: #9ca3af;
        }

        .shield-effect {
            border: 4px solid #60a5fa !important;
            animation: pulse 2s infinite;
        }
        
        .shield-effect::after {
            content: '';
            position: absolute;
            inset: 8px;
            background: rgba(96, 165, 250, 0.1);
            border-radius: 16px;
        }
        
        .slow-effect {
            background: rgba(139, 92, 246, 0.2) !important;
        }
        
        .slow-effect::after {
            content: '‚è∞';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
        }

        @media (max-width: 1200px) {
            .game-area {
                width: 90vw;
                max-width: 900px;
                height: 500px;
            }
            
            .title {
                font-size: 3rem;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .hud {
                flex-direction: column;
                gap: 15px;
            }
            
            .hud-left {
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .power-ups {
                flex-wrap: wrap;
            }
            
            .difficulty-selector {
                flex-direction: column;
                align-items: center;
            }
            
            .start-btn {
                font-size: 1.5rem;
                padding: 15px 30px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Menu Screen -->
        <div id="menuScreen" class="menu-screen">
            <div class="title">SWAHILI DEFENDER PRO</div>
            <div class="subtitle">üåç Master Kiswahili ‚Ä¢ Defend Earth ‚Ä¢ Unlock Achievements</div>
            
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-title">üéØ How to Play</div>
                    <div style="text-align: left;">
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 20px; border-radius: 15px; margin-bottom: 15px;">
                            <h3 style="color: #93c5fd; margin-bottom: 10px;">üéÆ Gameplay</h3>
                            <ul style="color: #bfdbfe; line-height: 1.6;">
                                <li>‚Ä¢ Word pairs fall from space with numbers</li>
                                <li>‚Ä¢ English (left) and Swahili (right) columns</li>
                                <li>‚Ä¢ <strong>Press two number keys directly</strong> to match pairs</li>
                                <li>‚Ä¢ Example: Press 3 then 7 to match word 3 with word 7</li>
                                <li>‚Ä¢ Don't let words reach Earth!</li>
                            </ul>
                        </div>
                        <div style="background: rgba(139, 92, 246, 0.1); padding: 20px; border-radius: 15px;">
                            <h3 style="color: #c4b5fd; margin-bottom: 10px;">‚ö° Power-ups</h3>
                            <ul style="color: #ddd6fe; line-height: 1.6;">
                                <li>‚Ä¢ üõ°Ô∏è Shield (Ctrl+1): Protect from one wave</li>
                                <li>‚Ä¢ ‚è∞ Slow Time (Ctrl+2): Half speed temporarily</li>
                                <li>‚Ä¢ üíé Double Points (Ctrl+3): 2X score boost</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-title">‚≠ê Premium Features</div>
                    <div style="text-align: left; space-y: 15px;">
                        <div style="background: rgba(34, 197, 94, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                            <h3 style="color: #86efac; margin-bottom: 8px;">üß† Smart Learning</h3>
                            <p style="color: #bbf7d0;">Progressive vocabulary introduction with 40+ Swahili words across 7 categories</p>
                        </div>
                        <div style="background: rgba(249, 115, 22, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                            <h3 style="color: #fdba74; margin-bottom: 8px;">üéÆ Engaging Mechanics</h3>
                            <p style="color: #fed7aa;">Streak bonuses, particle effects, achievements, and dynamic difficulty scaling</p>
                        </div>
                        <div style="background: rgba(236, 72, 153, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                            <h3 style="color: #f9a8d4; margin-bottom: 8px;">üìä Progress Tracking</h3>
                            <p style="color: #fce7f3;">Words learned counter, best streaks, and comprehensive achievement system</p>
                        </div>
                        <div style="background: rgba(251, 191, 36, 0.1); padding: 15px; border-radius: 10px;">
                            <h3 style="color: #fde047; margin-bottom: 8px;">‚å®Ô∏è Direct Control</h3>
                            <p style="color: #fef3c7;">No typing required! Press number keys directly to match word pairs instantly</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div>
                <h3 style="font-size: 1.5rem; margin-bottom: 20px;">Choose Your Challenge</h3>
                <div class="difficulty-selector">
                    <button class="difficulty-btn easy" data-difficulty="easy">üå± Beginner</button>
                    <button class="difficulty-btn normal selected" data-difficulty="normal">üöÄ Explorer</button>
                    <button class="difficulty-btn hard" data-difficulty="hard">‚ö° Master</button>
                </div>
            </div>
            
            <div style="margin-top: 40px;">
                <button class="start-btn" onclick="startGame()">‚ñ∂Ô∏è START DEFENDING</button>
                <button class="btn btn-primary" onclick="toggleStats()" style="font-size: 1.2rem; margin-left: 20px;">üèÜ Stats & Achievements</button>
            </div>
            
            <div id="soundToggle" style="margin-top: 20px;">
                <button class="btn btn-success" onclick="toggleSound()">üîä Sound: ON</button>
            </div>
            
            <!-- Stats Panel -->
            <div id="statsPanel" class="stats-panel hidden">
                <h3 style="font-size: 2rem; text-align: center; margin-bottom: 30px; color: #fde047;">üèÜ Your Progress</h3>
                <div class="stats-grid">
                    <div>
                        <h4 style="font-size: 1.3rem; margin-bottom: 20px; color: #93c5fd;">üìä Statistics</h4>
                        <div class="stat-item">
                            <span>Words Learned:</span>
                            <span id="wordsLearnedCount" style="color: #fde047; font-weight: bold;">0</span>
                        </div>
                        <div class="stat-item">
                            <span>Best Streak:</span>
                            <span id="bestStreakCount" style="color: #fde047; font-weight: bold;">0</span>
                        </div>
                        <div class="stat-item">
                            <span>High Score:</span>
                            <span id="highScoreCount" style="color: #fde047; font-weight: bold;">0</span>
                        </div>
                    </div>
                    <div>
                        <h4 style="font-size: 1.3rem; margin-bottom: 20px; color: #86efac;">üèÖ Achievements</h4>
                        <div id="achievementsList">
                            <!-- Achievements will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="game-screen">
            <!-- HUD -->
            <div class="hud">
                <div class="hud-left">
                    <div class="hud-stat">Score: <span id="score" style="color: #fde047;">0</span></div>
                    <div class="hud-stat">Level: <span id="level" style="color: #60a5fa;">1</span></div>
                    <div class="hud-stat">Streak: <span id="streak" style="color: #34d399;">0</span></div>
                    <div class="hud-stat">‚ù§Ô∏è <span id="lives">5</span></div>
                    <div class="hud-stat">Words: <span id="wordsLearned" style="color: #a78bfa;">0</span></div>
                </div>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <div class="power-ups">
                        <button id="shieldBtn" class="power-up-btn shield" onclick="activatePowerUp('shield')">üõ°Ô∏è SHIELD</button>
                        <button id="slowBtn" class="power-up-btn slow" onclick="activatePowerUp('slowTime')">‚ö° SLOW</button>
                        <button id="doubleBtn" class="power-up-btn double" onclick="activatePowerUp('doublePoints')">‚≠ê 2X</button>
                    </div>
                    <button class="btn btn-warning" onclick="togglePause()">‚è∏Ô∏è Pause</button>
                </div>
            </div>

            <!-- Game Area -->
            <div id="gameArea" class="game-area">
                <div class="column-label english-label">üåç ENGLISH</div>
                <div class="column-label swahili-label">KISWAHILI üåç</div>
                <div class="center-divider"></div>
                <div class="center-vs">VS</div>
                
                <!-- Pause Overlay -->
                <div id="pauseOverlay" class="pause-overlay hidden">
                    <div>
                        <div style="font-size: 4rem; margin-bottom: 30px;">‚è∏Ô∏è PAUSED</div>
                        <p style="font-size: 1.5rem; color: #93c5fd;">Mission on hold - Click Resume to continue!</p>
                        <div style="margin-top: 20px; color: rgba(255, 255, 255, 0.7);">
                            <p>üí° Tip: Use power-ups with Ctrl+1, Ctrl+2, Ctrl+3</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Keyboard Status -->
            <div class="keyboard-status">
                <div class="input-display">
                    <span style="font-size: 1.5rem; font-weight: bold; display: flex; align-items: center; gap: 10px;">
                        üéØ KEYBOARD INPUT:
                    </span>
                    <div id="keySequence" class="input-box">Press number keys to select targets...</div>
                    <div id="keyStatus" style="font-size: 1.1rem; color: rgba(255, 255, 255, 0.8);">Waiting for input</div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <p>Press two number keys directly to match English and Swahili translations</p>
                    <div style="display: flex; gap: 10px; font-size: 0.9rem;">
                        <span style="background: rgba(59, 130, 246, 0.2); padding: 5px 10px; border-radius: 8px;">Ctrl+1 üõ°Ô∏è</span>
                        <span style="background: rgba(139, 92, 246, 0.2); padding: 5px 10px; border-radius: 8px;">Ctrl+2 ‚è∞</span>
                        <span style="background: rgba(251, 191, 36, 0.2); padding: 5px 10px; border-radius: 8px;">Ctrl+3 üíé</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOverScreen" class="game-over-screen hidden">
            <h1 style="font-size: 4rem; font-weight: bold; margin-bottom: 30px; color: #ef4444;">MISSION FAILED</h1>
            <p style="font-size: 1.5rem; margin-bottom: 40px; color: #fca5a5;">The alien words have breached Earth's defenses!</p>
            
            <div class="feature-card" style="max-width: 800px; margin: 0 auto 40px;">
                <h2 style="font-size: 2.5rem; margin-bottom: 30px; color: #fde047;">üìä Mission Report</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px;">
                    <div style="background: rgba(251, 191, 36, 0.1); padding: 20px; border-radius: 15px;">
                        <div id="finalScore" style="font-size: 2rem; font-weight: bold; color: #fde047;">0</div>
                        <div style="color: #fef3c7;">Final Score</div>
                    </div>
                    <div style="background: rgba(59, 130, 246, 0.1); padding: 20px; border-radius: 15px;">
                        <div id="finalLevel" style="font-size: 2rem; font-weight: bold; color: #60a5fa;">1</div>
                        <div style="color: #dbeafe;">Level Reached</div>
                    </div>
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 20px; border-radius: 15px;">
                        <div id="finalStreak" style="font-size: 2rem; font-weight: bold; color: #34d399;">0</div>
                        <div style="color: #bbf7d0;">Best Streak</div>
                    </div>
                    <div style="background: rgba(139, 92, 246, 0.1); padding: 20px; border-radius: 15px;">
                        <div id="finalWords" style="font-size: 2rem; font-weight: bold; color: #a78bfa;">0</div>
                        <div style="color: #e9d5ff;">Words Learned</div>
                    </div>
                </div>
                
                <div id="vocabularyMastered" style="margin-top: 30px; padding: 20px; background: rgba(34, 197, 94, 0.1); border-radius: 15px; display: none;">
                    <h3 style="font-size: 1.3rem; font-weight: bold; margin-bottom: 15px; color: #86efac;">üéì Vocabulary Mastered</h3>
                    <div style="color: #bbf7d0;">
                        <span id="vocabularyMessage"></span> Keep practicing to expand your vocabulary.
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 30px; justify-content: center;">
                <button class="start-btn" onclick="startGame()">‚ñ∂Ô∏è Defend Again</button>
                <button class="start-btn" onclick="showMenu()" style="background: linear-gradient(45deg, #7c3aed, #ec4899);">üîÑ Main Menu</button>
            </div>
        </div>
    </div>

    <!-- Feedback Display -->
    <div id="feedback" class="feedback hidden"></div>

    <script>
        // Game state variables
        let gameState = 'menu';
        let fallingWords = [];
        let particles = [];
        let keySequence = '';
        let score = 0;
        let lives = 5;
        let level = 1;
        let nextWordId = 0;
        let feedback = '';
        let lastSpawnTime = 0;
        let streak = 0;
        let bestStreak = parseInt(localStorage.getItem('bestStreak') || '0');
        let highScore = parseInt(localStorage.getItem('highScore') || '0');
        let soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
        let powerUps = { shield: false, slowTime: false, doublePoints: false };
        let powerUpCooldowns = { shield: 0, slowTime: 0, doublePoints: 0 };
        let achievements = {
            firstMatch: localStorage.getItem('achievement_firstMatch') === 'true',
            streak5: localStorage.getItem('achievement_streak5') === 'true',
            streak10: localStorage.getItem('achievement_streak10') === 'true',
            level5: localStorage.getItem('achievement_level5') === 'true',
            level10: localStorage.getItem('achievement_level10') === 'true',
            linguist: localStorage.getItem('achievement_linguist') === 'true'
        };
        let wordsLearned = new Set(JSON.parse(localStorage.getItem('wordsLearned') || '[]'));
        let difficulty = localStorage.getItem('difficulty') || 'normal';
        let keyBuffer = [];
        let lastKeyTime = 0;
        let gameLoopInterval;
        
        const GAME_HEIGHT = 600;
        const GAME_WIDTH = 1000;
        const KEY_BUFFER_TIMEOUT = 2000;

        // Vocabulary data
        const vocabularyCategories = {
            basics: [
                { english: 'hello', swahili: 'hujambo', category: 'greetings' },
                { english: 'goodbye', swahili: 'kwaheri', category: 'greetings' },
                { english: 'please', swahili: 'tafadhali', category: 'greetings' },
                { english: 'thank you', swahili: 'asante', category: 'greetings' },
                { english: 'yes', swahili: 'ndiyo', category: 'basics' },
                { english: 'no', swahili: 'hapana', category: 'basics' },
            ],
            family: [
                { english: 'mother', swahili: 'mama', category: 'family' },
                { english: 'father', swahili: 'baba', category: 'family' },
                { english: 'child', swahili: 'mtoto', category: 'family' },
                { english: 'brother', swahili: 'ndugu', category: 'family' },
                { english: 'sister', swahili: 'dada', category: 'family' },
                { english: 'friend', swahili: 'rafiki', category: 'family' },
            ],
            nature: [
                { english: 'tree', swahili: 'mti', category: 'nature' },
                { english: 'water', swahili: 'maji', category: 'nature' },
                { english: 'sun', swahili: 'jua', category: 'nature' },
                { english: 'moon', swahili: 'mwezi', category: 'nature' },
                { english: 'river', swahili: 'mto', category: 'nature' },
                { english: 'mountain', swahili: 'mlima', category: 'nature' },
            ],
            daily: [
                { english: 'house', swahili: 'nyumba', category: 'daily' },
                { english: 'food', swahili: 'chakula', category: 'daily' },
                { english: 'book', swahili: 'kitabu', category: 'daily' },
                { english: 'school', swahili: 'shule', category: 'daily' },
                { english: 'money', swahili: 'pesa', category: 'daily' },
                { english: 'time', swahili: 'wakati', category: 'daily' },
                { english: 'car', swahili: 'gari', category: 'daily' },
                { english: 'door', swahili: 'mlango', category: 'daily' },
            ],
            body: [
                { english: 'hand', swahili: 'mkono', category: 'body' },
                { english: 'eye', swahili: 'jicho', category: 'body' },
                { english: 'heart', swahili: 'moyo', category: 'body' },
                { english: 'head', swahili: 'kichwa', category: 'body' },
                { english: 'foot', swahili: 'mguu', category: 'body' },
            ],
            emotions: [
                { english: 'love', swahili: 'upendo', category: 'emotions' },
                { english: 'happy', swahili: 'furaha', category: 'emotions' },
                { english: 'sad', swahili: 'huzuni', category: 'emotions' },
                { english: 'angry', swahili: 'hasira', category: 'emotions' },
            ],
            colors: [
                { english: 'red', swahili: 'nyekundu', category: 'colors' },
                { english: 'blue', swahili: 'buluu', category: 'colors' },
                { english: 'green', swahili: 'kijani', category: 'colors' },
                { english: 'yellow', swahili: 'njano', category: 'colors' },
                { english: 'black', swahili: 'nyeusi', category: 'colors' },
                { english: 'white', swahili: 'nyeupe', category: 'colors' },
            ]
        };

        const allVocabulary = Object.values(vocabularyCategories).flat();

        // Initialize UI
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            updateAchievements();
            updateDifficultySelection();
            updateSoundButton();
        });

        // Sound effects
        function playSound(frequency, duration = 100, type = 'sine') {
            if (!soundEnabled) return;
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration / 1000);
            } catch (e) {
                console.log('Audio not supported');
            }
        }

        // Particle system
        function createParticles(x, y, color = 'gold', count = 12) {
            const gameArea = document.getElementById('gameArea');
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.width = Math.random() * 6 + 2 + 'px';
                particle.style.height = particle.style.width;
                particle.style.backgroundColor = color;
                
                const vx = (Math.random() - 0.5) * 8;
                const vy = (Math.random() - 0.5) * 8 - 2;
                
                gameArea.appendChild(particle);
                
                animateParticle(particle, vx, vy);
            }
        }

        function animateParticle(particle, vx, vy) {
            let x = parseFloat(particle.style.left);
            let y = parseFloat(particle.style.top);
            let opacity = 1;
            
            function update() {
                x += vx;
                y += vy;
                vy += 0.2; // gravity
                opacity -= 0.02;
                
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.opacity = opacity;
                
                if (opacity > 0) {
                    requestAnimationFrame(update);
                } else {
                    particle.remove();
                }
            }
            
            update();
        }

        // Achievement system
        function checkAchievements(matchedWords, currentStreak, currentLevel) {
            if (matchedWords > 0 && !achievements.firstMatch) {
                achievements.firstMatch = true;
                localStorage.setItem('achievement_firstMatch', 'true');
                showAchievementNotification('First Match!', 'üéØ');
            }
            
            if (currentStreak >= 5 && !achievements.streak5) {
                achievements.streak5 = true;
                localStorage.setItem('achievement_streak5', 'true');
                showAchievementNotification('Hot Streak!', 'üî•');
            }
            
            if (currentStreak >= 10 && !achievements.streak10) {
                achievements.streak10 = true;
                localStorage.setItem('achievement_streak10', 'true');
                showAchievementNotification('Unstoppable!', '‚ö°');
            }
            
            if (currentLevel >= 5 && !achievements.level5) {
                achievements.level5 = true;
                localStorage.setItem('achievement_level5', 'true');
                showAchievementNotification('Rising Star!', 'üåü');
            }
            
            if (currentLevel >= 10 && !achievements.level10) {
                achievements.level10 = true;
                localStorage.setItem('achievement_level10', 'true');
                showAchievementNotification('Elite Defender!', 'üëë');
            }
            
            if (wordsLearned.size >= 15 && !achievements.linguist) {
                achievements.linguist = true;
                localStorage.setItem('achievement_linguist', 'true');
                showAchievementNotification('Swahili Linguist!', 'üìö');
            }
            
            updateAchievements();
        }

        function showAchievementNotification(title, icon) {
            showFeedback(`${icon} ACHIEVEMENT UNLOCKED: ${title}`, 3000);
            playSound(880, 200);
        }

        // Game speed calculations
        function getGameSpeed() {
            const baseSpeed = 1 + (level - 1) * 0.25;
            return powerUps.slowTime ? baseSpeed * 0.5 : baseSpeed;
        }

        function getSpawnInterval() {
            const baseInterval = difficulty === 'easy' ? 3500 : difficulty === 'hard' ? 1800 : 2500;
            const adjustedInterval = baseInterval - (level - 1) * 150;
            const finalInterval = Math.max(1200, adjustedInterval);
            return powerUps.slowTime ? finalInterval * 1.5 : finalInterval;
        }

        function getFallSpeed() {
            const baseSpeed = difficulty === 'easy' ? 25 : difficulty === 'hard' ? 45 : 35;
            return baseSpeed * getGameSpeed();
        }

        // Word generation
        function getRandomWord() {
            let availableWords = allVocabulary;
            if (level <= 3) {
                availableWords = vocabularyCategories.basics.concat(vocabularyCategories.family);
            } else if (level <= 6) {
                availableWords = vocabularyCategories.basics.concat(vocabularyCategories.family, vocabularyCategories.daily);
            }
            
            return availableWords[Math.floor(Math.random() * availableWords.length)];
        }

        function getUsedNumbers() {
            return fallingWords.map(word => word.displayNumber);
        }

        function getAvailableNumbers() {
            const used = getUsedNumbers();
            return [1,2,3,4,5,6,7,8,9].filter(num => !used.includes(num));
        }

        function createWordPair() {
            const available = getAvailableNumbers();
            if (available.length < 2) return null;

            const word = getRandomWord();
            const [englishNum, swahiliNum] = available.sort(() => Math.random() - 0.5).slice(0, 2);

            return {
                english: {
                    id: nextWordId,
                    text: word.english,
                    type: 'english',
                    x: Math.random() * (GAME_WIDTH * 0.35) + 80,
                    y: -60,
                    displayNumber: englishNum,
                    pairText: word.swahili,
                    category: word.category
                },
                swahili: {
                    id: nextWordId + 1,
                    text: word.swahili,
                    type: 'swahili',
                    x: Math.random() * (GAME_WIDTH * 0.35) + GAME_WIDTH * 0.6,
                    y: -60,
                    displayNumber: swahiliNum,
                    pairText: word.english,
                    category: word.category
                }
            };
        }

        // Word spawning
        function spawnWords() {
            const now = Date.now();
            if (now - lastSpawnTime > getSpawnInterval()) {
                const pair = createWordPair();
                if (pair) {
                    fallingWords.push(pair.english, pair.swahili);
                    renderWord(pair.english);
                    renderWord(pair.swahili);
                    nextWordId += 2;
                    lastSpawnTime = now;
                }
            }
        }

        function renderWord(word) {
            const gameArea = document.getElementById('gameArea');
            const wordElement = document.createElement('div');
            wordElement.className = `falling-word ${word.type}-word`;
            wordElement.id = `word-${word.id}`;
            wordElement.style.left = word.x + 'px';
            wordElement.style.top = word.y + 'px';
            
            wordElement.innerHTML = `
                <div class="word-number">${word.displayNumber}</div>
                <div class="word-text">${word.text}</div>
                <div class="word-category">${word.category}</div>
            `;
            
            gameArea.appendChild(wordElement);
        }

        // Match checking
        function checkMatch(sequence) {
            if (sequence.length !== 2) return false;

            const [num1, num2] = sequence;
            
            const word1 = fallingWords.find(w => w.displayNumber === num1);
            const word2 = fallingWords.find(w => w.displayNumber === num2);

            if (!word1 || !word2) {
                showFeedback('üéØ Numbers not found!', 1500);
                playSound(180, 200);
                return false;
            }

            const isMatch = (word1.text === word2.pairText && word2.text === word1.pairText);

            if (isMatch) {
                // Create particle effect
                const avgX = (word1.x + word2.x) / 2;
                const avgY = (word1.y + word2.y) / 2;
                createParticles(avgX, avgY, '#ffd700', 15);
                
                // Remove matched words
                fallingWords = fallingWords.filter(w => 
                    w.displayNumber !== num1 && w.displayNumber !== num2
                );
                
                document.getElementById(`word-${word1.id}`)?.remove();
                document.getElementById(`word-${word2.id}`)?.remove();
                
                // Add words to learned set
                wordsLearned.add(word1.text);
                wordsLearned.add(word2.text);
                localStorage.setItem('wordsLearned', JSON.stringify([...wordsLearned]));
                
                // Calculate points
                let basePoints = 15 * level;
                const streakBonus = streak * 2;
                const doubleBonus = powerUps.doublePoints ? basePoints : 0;
                const totalPoints = basePoints + streakBonus + doubleBonus;
                
                score += totalPoints;
                streak++;
                bestStreak = Math.max(bestStreak, streak);
                localStorage.setItem('bestStreak', bestStreak.toString());
                
                // Update display
                updateGameUI();
                
                // Sound and feedback
                playSound(660 + streak * 20, 150);
                showFeedback(`‚ú® Perfect! ${word1.text} = ${word2.text} (+${totalPoints} pts)${powerUps.doublePoints ? ' 2X!' : ''}`, 2500);
                
                // Check achievements
                checkAchievements(1, streak, level);
                
                return true;
            } else {
                streak = 0;
                playSound(180, 200);
                showFeedback(`‚ùå Wrong! ${word1.text} ‚â† ${word2.text} (${word1.pairText})`, 2500);
                updateGameUI();
                return false;
            }
        }

        // Power-ups
        function activatePowerUp(type) {
            if (powerUpCooldowns[type] > 0) return;
            
            powerUps[type] = true;
            powerUpCooldowns[type] = type === 'shield' ? 10 : type === 'slowTime' ? 8 : 12;
            
            playSound(880, 200);
            showFeedback(`üöÄ ${type.toUpperCase()} ACTIVATED!`, 2000);
            
            updatePowerUpButtons();
            
            if (type === 'shield') {
                document.getElementById('gameArea').classList.add('shield-effect');
            } else if (type === 'slowTime') {
                document.getElementById('gameArea').classList.add('slow-effect');
            }
        }

        function updatePowerUps() {
            // Update cooldowns
            for (let type in powerUpCooldowns) {
                if (powerUpCooldowns[type] > 0) {
                    powerUpCooldowns[type] -= 1/60;
                    if (powerUpCooldowns[type] <= 0) {
                        powerUps[type] = false;
                        if (type === 'shield') {
                            document.getElementById('gameArea').classList.remove('shield-effect');
                        } else if (type === 'slowTime') {
                            document.getElementById('gameArea').classList.remove('slow-effect');
                        }
                    }
                }
            }
            
            updatePowerUpButtons();
        }

        function updatePowerUpButtons() {
            const buttons = {
                shield: document.getElementById('shieldBtn'),
                slowTime: document.getElementById('slowBtn'),
                doublePoints: document.getElementById('doubleBtn')
            };
            
            for (let type in buttons) {
                const btn = buttons[type];
                const cooldown = powerUpCooldowns[type];
                
                if (powerUps[type]) {
                    btn.textContent = btn.textContent.split(' ')[0] + ' ACTIVE';
                    btn.className = btn.className.replace('cooldown', '').replace('active', '') + ' active';
                } else if (cooldown > 0) {
                    btn.textContent = btn.textContent.split(' ')[0] + ' ' + Math.ceil(cooldown);
                    btn.className = btn.className.replace('active', '').replace('cooldown', '') + ' cooldown';
                } else {
                    const labels = { shield: 'SHIELD', slowTime: 'SLOW', doublePoints: '2X' };
                    btn.textContent = btn.textContent.split(' ')[0] + ' ' + labels[type];
                    btn.className = btn.className.replace('active', '').replace('cooldown', '');
                }
            }
        }

        // Input handling
        function handleKeyPress(event) {
            if (gameState !== 'playing') return;
            
            const key = event.key;
            
            // Power-ups with Ctrl
            if (event.ctrlKey) {
                if (key === '1') {
                    event.preventDefault();
                    activatePowerUp('shield');
                    return;
                } else if (key === '2') {
                    event.preventDefault();
                    activatePowerUp('slowTime');
                    return;
                } else if (key === '3') {
                    event.preventDefault();
                    activatePowerUp('doublePoints');
                    return;
                }
            }
            
            // Only process number keys 1-9
            if (!/^[1-9]$/.test(key)) return;
            
            event.preventDefault();
            
            const number = parseInt(key);
            const currentTime = Date.now();
            
            // Clear buffer if too much time has passed
            if (keyBuffer.length > 0 && currentTime - lastKeyTime > KEY_BUFFER_TIMEOUT) {
                keyBuffer = [number];
                keySequence = number.toString();
            } else {
                keyBuffer.push(number);
                
                if (keyBuffer.length >= 2) {
                    const matchSequence = keyBuffer.slice(0, 2);
                    setTimeout(() => {
                        checkMatch(matchSequence);
                        clearKeyBuffer();
                    }, 50);
                    
                    keySequence = matchSequence.join('-');
                } else {
                    keySequence = keyBuffer[0].toString();
                }
            }
            
            lastKeyTime = currentTime;
            updateKeyboardDisplay();
            updateWordHighlights();
            
            playSound(440 + (number * 20), 50);
            
            // Auto-clear buffer after timeout
            setTimeout(() => {
                if (keyBuffer.length === 1) {
                    clearKeyBuffer();
                }
            }, KEY_BUFFER_TIMEOUT);
        }

        function clearKeyBuffer() {
            keyBuffer = [];
            keySequence = '';
            updateKeyboardDisplay();
            updateWordHighlights();
        }

        function updateKeyboardDisplay() {
            const keySequenceDisplay = document.getElementById('keySequence');
            const keyStatus = document.getElementById('keyStatus');
            
            if (keySequence) {
                keySequenceDisplay.textContent = keySequence;
            } else {
                keySequenceDisplay.textContent = 'Press number keys to select targets...';
            }
            
            if (keyBuffer.length === 0) {
                keyStatus.textContent = 'Waiting for input';
            } else if (keyBuffer.length === 1) {
                keyStatus.textContent = 'Press second number';
            } else if (keyBuffer.length === 2) {
                keyStatus.textContent = 'Processing...';
            }
        }

        function updateWordHighlights() {
            // Remove all highlights
            document.querySelectorAll('.falling-word').forEach(word => {
                word.classList.remove('selected-word');
            });
            
            // Add highlights for selected numbers
            keyBuffer.forEach(num => {
                const word = fallingWords.find(w => w.displayNumber === num);
                if (word) {
                    document.getElementById(`word-${word.id}`)?.classList.add('selected-word');
                }
            });
        }

        // Game loop
        function updateGame() {
            if (gameState !== 'playing') return;

            // Update power-ups
            updatePowerUps();

            // Move words down
            const speed = getFallSpeed();
            fallingWords.forEach(word => {
                word.y += speed / 60;
                const element = document.getElementById(`word-${word.id}`);
                if (element) {
                    element.style.top = word.y + 'px';
                }
            });

            // Check for words that reached bottom
            const hitBottom = fallingWords.filter(word => word.y > GAME_HEIGHT + 50);
            if (hitBottom.length > 0) {
                if (!powerUps.shield) {
                    lives = Math.max(0, lives - hitBottom.length);
                    streak = 0;
                    showFeedback(`Words breached Earth! -${hitBottom.length} lives`, 2000);
                    playSound(220, 300);
                } else {
                    showFeedback('üõ°Ô∏è Shield protected you!', 1500);
                }
                
                // Remove words that hit bottom
                hitBottom.forEach(word => {
                    document.getElementById(`word-${word.id}`)?.remove();
                });
                fallingWords = fallingWords.filter(word => word.y <= GAME_HEIGHT + 50);
            }

            // Spawn new words
            spawnWords();
            
            updateGameUI();

            // Check game over
            if (lives <= 0) {
                endGame();
            }
            
            // Check level up
            const newLevel = Math.floor(score / 200) + 1;
            if (newLevel > level) {
                level = newLevel;
                playSound(880, 300);
                createParticles(GAME_WIDTH/2, GAME_HEIGHT/2, '#00ff00', 20);
                showFeedback(`üéâ LEVEL UP! Welcome to Level ${newLevel}!`, 3000);
                checkAchievements(0, streak, level);
                updateGameUI();
            }
        }

        // UI Updates
        function updateGameUI() {
            document.getElementById('score').textContent = score.toLocaleString();
            document.getElementById('level').textContent = level;
            document.getElementById('streak').textContent = streak;
            document.getElementById('lives').textContent = lives;
            document.getElementById('wordsLearned').textContent = wordsLearned.size;
        }

        function updateStats() {
            document.getElementById('wordsLearnedCount').textContent = wordsLearned.size;
            document.getElementById('bestStreakCount').textContent = bestStreak;
            document.getElementById('highScoreCount').textContent = highScore;
        }

        function updateAchievements() {
            const achievementsList = document.getElementById('achievementsList');
            const achievementData = [
                { key: 'firstMatch', name: 'First Match', icon: 'üéØ' },
                { key: 'streak5', name: 'Hot Streak', icon: 'üî•' },
                { key: 'streak10', name: 'Unstoppable', icon: '‚ö°' },
                { key: 'level5', name: 'Rising Star', icon: 'üåü' },
                { key: 'level10', name: 'Elite Defender', icon: 'üëë' },
                { key: 'linguist', name: 'Swahili Linguist', icon: 'üìö' }
            ];
            
            achievementsList.innerHTML = achievementData.map(ach => `
                <div class="achievement-item ${achievements[ach.key] ? 'achievement-unlocked' : 'achievement-locked'}">
                    <span style="font-size: 1.2rem;">${ach.icon}</span>
                    <span style="font-weight: bold;">${ach.name}</span>
                    ${achievements[ach.key] ? '<span style="margin-left: auto; color: #34d399;">‚úì</span>' : ''}
                </div>
            `).join('');
        }

        function updateDifficultySelection() {
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.dataset.difficulty === difficulty) {
                    btn.classList.add('selected');
                }
            });
        }

        function updateSoundButton() {
            const btn = document.querySelector('#soundToggle button');
            btn.textContent = soundEnabled ? 'üîä Sound: ON' : 'üîá Sound: OFF';
            btn.className = soundEnabled ? 'btn btn-success' : 'btn btn-danger';
        }

        // Game state functions
        function startGame() {
            gameState = 'playing';
            fallingWords = [];
            particles = [];
            score = 0;
            lives = 5;
            level = 1;
            nextWordId = 0;
            keyBuffer = [];
            keySequence = '';
            feedback = '';
            lastSpawnTime = Date.now();
            lastKeyTime = 0;
            streak = 0;
            powerUps = { shield: false, slowTime: false, doublePoints: false };
            powerUpCooldowns = { shield: 0, slowTime: 0, doublePoints: 0 };
            
            // Clear game area
            const gameArea = document.getElementById('gameArea');
            gameArea.querySelectorAll('.falling-word, .particle').forEach(el => el.remove());
            gameArea.classList.remove('shield-effect', 'slow-effect');
            
            // Show game screen
            showScreen('gameScreen');
            
            updateGameUI();
            updateKeyboardDisplay();
            updatePowerUpButtons();
            
            // Start game loop
            gameLoopInterval = setInterval(updateGame, 1000/60);
        }

        function togglePause() {
            if (gameState === 'playing') {
                gameState = 'paused';
                document.getElementById('pauseOverlay').classList.remove('hidden');
                clearInterval(gameLoopInterval);
            } else if (gameState === 'paused') {
                gameState = 'playing';
                document.getElementById('pauseOverlay').classList.add('hidden');
                gameLoopInterval = setInterval(updateGame, 1000/60);
                lastSpawnTime = Date.now(); // Reset spawn timer
            }
        }

        function endGame() {
            gameState = 'gameOver';
            clearInterval(gameLoopInterval);
            
            // Update high score
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('highScore', highScore.toString());
            }
            
            // Update final stats
            document.getElementById('finalScore').textContent = score.toLocaleString();
            document.getElementById('finalLevel').textContent = level;
            document.getElementById('finalStreak').textContent = bestStreak;
            document.getElementById('finalWords').textContent = wordsLearned.size;
            
            if (wordsLearned.size > 0) {
                document.getElementById('vocabularyMastered').style.display = 'block';
                document.getElementById('vocabularyMessage').textContent = `You've learned ${wordsLearned.size} Swahili words!`;
            }
            
            showScreen('gameOverScreen');
            playSound(220, 500);
            clearKeyBuffer();
        }

        function showMenu() {
            gameState = 'menu';
            clearInterval(gameLoopInterval);
            showScreen('menuScreen');
            updateStats();
            clearKeyBuffer();
        }

        function showScreen(screenId) {
            document.querySelectorAll('.menu-screen, .game-screen, .game-over-screen').forEach(screen => {
                screen.style.display = 'none';
            });
            document.getElementById(screenId).style.display = 'block';
        }

        // Feedback system
        function showFeedback(message, duration = 2000) {
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.textContent = message;
            feedbackEl.classList.remove('hidden');
            
            setTimeout(() => {
                feedbackEl.classList.add('hidden');
            }, duration);
        }

        // Settings and UI functions
        function toggleStats() {
            const panel = document.getElementById('statsPanel');
            panel.classList.toggle('hidden');
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            localStorage.setItem('soundEnabled', soundEnabled.toString());
            updateSoundButton();
        }

        // Difficulty selection
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                difficulty = this.dataset.difficulty;
                localStorage.setItem('difficulty', difficulty);
                updateDifficultySelection();
            });
        });

        // Event listeners
        document.addEventListener('keydown', handleKeyPress);

        // Prevent default behavior for number keys to avoid conflicts
        document.addEventListener('keydown', function(e) {
            if (/^[1-9]$/.test(e.key) && gameState === 'playing') {
                e.preventDefault();
            }
        });

        // Initialize game on load
        document.addEventListener('DOMContentLoaded', function() {
            showScreen('menuScreen');
        });
    </script>
</body>
</html>