<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZType Swahili Challenge</title>
  <style>
    /* ==================== RESET & BASE ==================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body { 
      background: radial-gradient(ellipse at center, #0a0a2e 0%, #000000 70%);
      color: #fff; 
      font-family: 'Courier New', monospace; 
      overflow: hidden; 
      position: relative;
      height: 100vh;
    }

    /* ==================== BACKGROUND ==================== */
    .stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    /* ==================== MENU STYLES ==================== */
    .menu {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      background: linear-gradient(145deg, rgba(0,0,0,0.9), rgba(20,20,50,0.8));
      padding: 40px 50px;
      border-radius: 15px;
      border: 2px solid #00ff41;
      z-index: 20;
      max-width: 500px;
      box-shadow: 0 0 30px rgba(0, 255, 65, 0.3);
      backdrop-filter: blur(10px);
    }

    .menu h1 {
      color: #00ff41;
      margin-bottom: 15px;
      font-size: 28px;
      text-shadow: 0 0 10px rgba(0, 255, 65, 0.8);
      letter-spacing: 2px;
      animation: pulse 2s infinite;
    }

    .menu h2 {
      color: #ffff00;
      margin-bottom: 25px;
      font-size: 16px;
      opacity: 0.9;
    }

    .rules {
      margin: 20px 0;
      padding: 20px;
      background: rgba(0, 255, 65, 0.05);
      border-radius: 10px;
      font-size: 14px;
      line-height: 1.6;
      border: 1px solid rgba(0, 255, 65, 0.2);
    }

    .rule-item {
      display: flex;
      align-items: center;
      margin: 8px 0;
      padding: 5px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 5px;
    }

    .rule-icon {
      width: 20px;
      height: 20px;
      margin-right: 10px;
      background: #00ff41;
      color: #000;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 12px;
    }

    .settings {
      margin: 25px 0;
    }

    .setting-group label {
      display: block;
      color: #ffff00;
      margin-bottom: 15px;
      font-size: 16px;
      font-weight: bold;
    }

    .radio-group {
      display: flex;
      justify-content: center;
      gap: 30px;
    }

    .radio-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-size: 14px;
      padding: 15px;
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid transparent;
      transition: all 0.3s ease;
    }

    .radio-option:hover {
      background: rgba(0, 255, 65, 0.1);
      border-color: #00ff41;
    }

    .radio-option.selected {
      border-color: #00ff41;
      background: rgba(0, 255, 65, 0.15);
      box-shadow: 0 0 10px rgba(0, 255, 65, 0.3);
    }

    .radio-option input[type="radio"] {
      accent-color: #00ff41;
    }

    .start-btn {
      padding: 12px 30px;
      background: linear-gradient(45deg, #00ff41, #00cc33);
      color: #000;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 0 20px rgba(0, 255, 65, 0.4);
      transition: all 0.3s;
    }

    .start-btn:hover {
      background: linear-gradient(45deg, #00cc33, #00ff41);
      transform: translateY(-2px);
      box-shadow: 0 0 25px rgba(0, 255, 65, 0.6);
    }

    /* ==================== GAME SCREEN ==================== */
    .game-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10;
      display: none;
    }

    .game-screen.active {
      display: block;
    }

    /* ==================== GAME HEADER ==================== */
    .game-header {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100px;
      background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, transparent 100%);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 40px;
      z-index: 15;
    }

    .game-title {
      font-size: 24px;
      color: #00ff41;
      text-shadow: 0 0 10px rgba(0, 255, 65, 0.8);
      letter-spacing: 2px;
    }

    .game-stats {
      display: flex;
      gap: 30px;
    }

    .stat-item {
      text-align: center;
      font-size: 14px;
    }

    .stat-label {
      color: #ffff00;
      display: block;
      margin-bottom: 5px;
    }

    .stat-value {
      color: #00ff41;
      font-size: 18px;
      font-weight: bold;
    }

    .selection-indicator {
      color: #ff8800;
      font-size: 16px;
      font-weight: bold;
      margin-left: 20px;
    }

    /* ==================== CENTER DIVIDER ==================== */
    .center-divider {
      position: absolute;
      left: 50%;
      top: 0;
      width: 3px;
      height: 100%;
      background: linear-gradient(
        180deg, 
        transparent 0%, 
        #00ff41 20%, 
        #00ff41 80%, 
        transparent 100%
      );
      box-shadow: 0 0 20px rgba(0, 255, 65, 0.6);
      z-index: 12;
      animation: dividerPulse 3s infinite;
    }

    /* ==================== GAME COLUMNS ==================== */
    .game-columns {
      display: flex;
      height: 100vh;
      padding-top: 100px;
    }

    .game-column {
      flex: 1;
      position: relative;
      padding: 40px;
      overflow: hidden;
    }

    .column-header {
      text-align: center;
      margin-bottom: 40px;
      position: relative;
      z-index: 14;
    }

    .column-title {
      font-size: 32px;
      font-weight: bold;
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-bottom: 10px;
      text-shadow: 0 0 15px currentColor;
    }

    .column-subtitle {
      font-size: 16px;
      opacity: 0.8;
      font-style: italic;
    }

    /* Styles spécifiques pour la colonne maître */
    .column-master .column-title {
      color: #00ff41;
      animation: masterGlow 2s infinite alternate;
    }

    .column-master .column-subtitle {
      color: #00ff41;
    }

    .column-master {
      background: radial-gradient(
        ellipse at center, 
        rgba(0, 255, 65, 0.05) 0%, 
        transparent 70%
      );
    }

    /* Styles pour l'autre colonne */
    .column-other .column-title {
      color: #ffff00;
      animation: otherGlow 2s infinite alternate;
    }

    .column-other .column-subtitle {
      color: #ffff00;
    }

    .column-other {
      background: radial-gradient(
        ellipse at center, 
        rgba(255, 255, 0, 0.05) 0%, 
        transparent 70%
      );
    }

    /* ==================== WORD AREA ==================== */
    .words-area {
      height: calc(100% - 120px);
      position: relative;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      background: rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }

    .words-placeholder {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      opacity: 0.5;
      font-size: 18px;
    }

    /* ==================== FALLING WORDS ==================== */
    .falling-word {
      position: absolute;
      padding: 12px 20px;
      border-radius: 25px;
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 80px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(5px);
    }

    .falling-word .word-number {
      display: inline-block;
      width: 25px;
      height: 25px;
      border-radius: 50%;
      background: #000;
      color: #fff;
      font-size: 14px;
      font-weight: bold;
      line-height: 25px;
      margin-right: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
    }

    .falling-word .word-text {
      font-size: 16px;
      letter-spacing: 1px;
    }

    /* Styles pour les mots de la colonne maître */
    .falling-word.master-word {
      background: linear-gradient(135deg, rgba(0, 255, 65, 0.9), rgba(0, 255, 65, 0.7));
      color: #000;
      border: 2px solid #00ff41;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .falling-word.master-word:hover {
      background: linear-gradient(135deg, rgba(0, 255, 65, 1), rgba(0, 255, 65, 0.8));
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(0, 255, 65, 0.4);
    }

    /* Styles pour les mots de l'autre colonne */
    .falling-word.other-word {
      background: linear-gradient(135deg, rgba(255, 255, 0, 0.9), rgba(255, 255, 0, 0.7));
      color: #000;
      border: 2px solid #ffff00;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .falling-word.other-word:hover {
      background: linear-gradient(135deg, rgba(255, 255, 0, 1), rgba(255, 255, 0, 0.8));
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(255, 255, 0, 0.4);
    }

    /* État waiting-master (1er clic - attente) */
    .falling-word.waiting-master {
      transform: scale(1.2);
      box-shadow: 0 0 30px rgba(0, 255, 65, 1);
      border-width: 4px;
      animation: waitingPulse 1s infinite;
    }

    /* État checking-other (2ème clic - vérification) */
    .falling-word.checking-other {
      transform: scale(1.2);
      box-shadow: 0 0 30px rgba(255, 255, 0, 1);
      border-width: 4px;
      animation: checkingPulse 0.3s infinite;
    }

    /* Animations pour les états */
    @keyframes waitingPulse {
      0% { box-shadow: 0 0 30px rgba(0, 255, 65, 1); }
      50% { box-shadow: 0 0 40px rgba(0, 255, 65, 0.7); }
      100% { box-shadow: 0 0 30px rgba(0, 255, 65, 1); }
    }

    @keyframes checkingPulse {
      0% { transform: scale(1.2); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1.2); }
    }

    /* Animation de match réussi */
    .falling-word.matched {
      animation: wordMatched 1s ease forwards;
    }

    @keyframes wordMatched {
      0% { 
        transform: scale(1.2); 
        box-shadow: 0 0 30px rgba(0, 255, 65, 1);
      }
      30% { 
        transform: scale(1.8);
        box-shadow: 0 0 50px rgba(0, 255, 65, 1);
        background: linear-gradient(135deg, rgba(0, 255, 65, 1), rgba(255, 255, 255, 0.8));
      }
      70% { 
        transform: scale(2);
        box-shadow: 0 0 60px rgba(0, 255, 65, 1);
      }
      100% { 
        transform: scale(0);
        opacity: 0;
        box-shadow: 0 0 80px rgba(0, 255, 65, 0.3);
      }
    }

    /* Animation d'erreur */
    .falling-word.error {
      animation: wordError 0.8s ease forwards;
    }

    @keyframes wordError {
      0% { transform: translateX(0) rotate(0deg); }
      10% { transform: translateX(-15px) rotate(-10deg); }
      20% { transform: translateX(15px) rotate(10deg); }
      30% { transform: translateX(-10px) rotate(-5deg); }
      40% { transform: translateX(10px) rotate(5deg); }
      50% { transform: translateX(-5px) rotate(-2deg); }
      60% { transform: translateX(5px) rotate(2deg); }
      70% { transform: translateX(0) rotate(0deg); }
      100% { 
        transform: translateX(0) rotate(0deg);
        background: linear-gradient(135deg, rgba(255, 68, 68, 0.9), rgba(255, 68, 68, 0.7));
        border-color: #ff4444;
      }
    }

    /* Particules d'explosion pour les matches réussis */
    .match-particles {
      position: absolute;
      pointer-events: none;
      z-index: 100;
    }

    .particle {
      position: absolute;
      width: 6px;
      height: 6px;
      background: #00ff41;
      border-radius: 50%;
      animation: particleExplosion 1s ease-out forwards;
    }

    @keyframes particleExplosion {
      0% {
        transform: scale(1);
        opacity: 1;
      }
      100% {
        transform: scale(0);
        opacity: 0;
      }
    }

    /* ==================== ANIMATIONS ==================== */
    @keyframes pulse {
      0% { text-shadow: 0 0 10px rgba(0, 255, 65, 0.8); }
      50% { text-shadow: 0 0 20px rgba(0, 255, 65, 1), 0 0 30px rgba(0, 255, 65, 0.8); }
      100% { text-shadow: 0 0 10px rgba(0, 255, 65, 0.8); }
    }

    @keyframes masterGlow {
      0% { 
        text-shadow: 0 0 15px #00ff41;
        transform: scale(1);
      }
      100% { 
        text-shadow: 0 0 25px #00ff41, 0 0 35px #00ff41;
        transform: scale(1.05);
      }
    }

    @keyframes otherGlow {
      0% { 
        text-shadow: 0 0 15px #ffff00;
        transform: scale(1);
      }
      100% { 
        text-shadow: 0 0 25px #ffff00, 0 0 35px #ffff00;
        transform: scale(1.05);
      }
    }

    @keyframes dividerPulse {
      0% { 
        box-shadow: 0 0 20px rgba(0, 255, 65, 0.6);
        transform: scaleX(1);
      }
      50% { 
        box-shadow: 0 0 40px rgba(0, 255, 65, 1);
        transform: scaleX(1.5);
      }
      100% { 
        box-shadow: 0 0 20px rgba(0, 255, 65, 0.6);
        transform: scaleX(1);
      }
    }

    /* ==================== TRANSITIONS ==================== */
    .menu {
      transition: all 0.5s ease;
    }

    .menu.fade-out {
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.8);
    }

    .game-screen {
      transition: all 0.5s ease;
    }

    /* ==================== UTILITY CLASSES ==================== */
    .hidden {
      display: none !important;
    }

    .fade-in {
      animation: fadeIn 0.5s ease forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <canvas class="stars" id="stars"></canvas>
  
  <!-- ==================== MENU SCREEN ==================== -->
  <div class="menu" id="main-menu">
    <h1>⚡ ZTYPE SWAHILI ⚡</h1>
    <h2>Lightning Fast Word Matching</h2>
    
    <div class="rules">
      <div class="rule-item">
        <div class="rule-icon">★</div>
        <div>Match the correct number from English to Swahili or Swahili to English</div>
      </div>
    </div>
    
    <div class="settings">
      <div class="setting-group">
        <label>Choose Master Language</label>
        <div class="radio-group">
          <div class="radio-option selected" data-value="english">
            <input type="radio" id="english-first" name="masterLanguage" value="english" checked>
            <div>English First</div>
          </div>
          <div class="radio-option" data-value="swahili">
            <input type="radio" id="swahili-first" name="masterLanguage" value="swahili">
            <div>Swahili First</div>
          </div>
        </div>
      </div>
    </div>
    
    <button class="start-btn" id="start-game">
      ▶ START MISSION
    </button>
  </div>

  <!-- ==================== GAME SCREEN ==================== -->
  <div class="game-screen" id="game-screen">
    <!-- Header avec stats -->
    <div class="game-header">
      <div class="game-title">⚡ ZTYPE SWAHILI ⚡</div>
      <div class="game-stats">
        <div class="stat-item">
          <span class="stat-label">SCORE</span>
          <span class="stat-value" id="game-score">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">LEVEL</span>
          <span class="stat-value" id="game-level">1</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">LIVES</span>
          <span class="stat-value" id="game-lives">3</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">STREAK</span>
          <span class="stat-value" id="game-streak">0</span>
        </div>
        <div class="selection-indicator" id="selection-indicator">
          Next: Master Word
        </div>
      </div>
    </div>

    <!-- Diviseur central -->
    <div class="center-divider"></div>

    <!-- Colonnes de jeu -->
    <div class="game-columns">
      <!-- Colonne Maître -->
      <div class="game-column column-master" id="master-column">
        <div class="column-header">
          <div class="column-title" id="master-title">ENGLISH</div>
        </div>
        <div class="words-area">
          <div class="words-placeholder">
            Words will appear here...
          </div>
        </div>
      </div>

      <!-- Colonne Autre -->
      <div class="game-column column-other" id="other-column">
        <div class="column-header">
          <div class="column-title" id="other-title">SWAHILI</div>
        </div>
        <div class="words-area">
          <div class="words-placeholder">
            Translations will appear here...
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==================== CONFIGURATION ====================
    const CONFIG = {
      STARS_COUNT: 200,
      COLORS: {
        primary: '#00ff41',
        secondary: '#ffff00',
        danger: '#ff4444',
        accent: '#ff8800'
      }
    };

    // ==================== AUDIO MANAGER ====================
    class AudioManager {
      constructor() {
        this.audioContext = null;
        this.init();
      }

      init() {
        try {
          this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        } catch (e) {
          console.log('Audio not supported');
        }
      }

      playSuccessSound() {
        if (!this.audioContext) return;
        
        const oscillator = this.audioContext.createOscillator();
        const gainNode = this.audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(this.audioContext.destination);
        
        // Mélodie de succès (accord majeur)
        oscillator.frequency.setValueAtTime(523, this.audioContext.currentTime); // Do
        oscillator.frequency.setValueAtTime(659, this.audioContext.currentTime + 0.1); // Mi
        oscillator.frequency.setValueAtTime(784, this.audioContext.currentTime + 0.2); // Sol
        
        gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
        
        oscillator.start(this.audioContext.currentTime);
        oscillator.stop(this.audioContext.currentTime + 0.5);
      }

      playErrorSound() {
        if (!this.audioContext) return;
        
        const oscillator = this.audioContext.createOscillator();
        const gainNode = this.audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(this.audioContext.destination);
        
        // Son d'erreur (note descendante)
        oscillator.frequency.setValueAtTime(400, this.audioContext.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(200, this.audioContext.currentTime + 0.3);
        
        gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);
        
        oscillator.start(this.audioContext.currentTime);
        oscillator.stop(this.audioContext.currentTime + 0.3);
      }

      playSelectSound() {
        if (!this.audioContext) return;
        
        const oscillator = this.audioContext.createOscillator();
        const gainNode = this.audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(this.audioContext.destination);
        
        oscillator.frequency.setValueAtTime(800, this.audioContext.currentTime);
        gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.1);
        
        oscillator.start(this.audioContext.currentTime);
        oscillator.stop(this.audioContext.currentTime + 0.1);
      }
    }

    // ==================== VISUAL EFFECTS ====================
    class VisualEffects {
      static createMatchParticles(x, y) {
        const container = document.createElement('div');
        container.className = 'match-particles';
        container.style.left = x + 'px';
        container.style.top = y + 'px';
        
        for (let i = 0; i < 12; i++) {
          const particle = document.createElement('div');
          particle.className = 'particle';
          
          const angle = (i * 30) * Math.PI / 180;
          const distance = Math.random() * 100 + 50;
          const finalX = Math.cos(angle) * distance;
          const finalY = Math.sin(angle) * distance;
          
          particle.style.left = '0px';
          particle.style.top = '0px';
          particle.style.setProperty('--final-x', finalX + 'px');
          particle.style.setProperty('--final-y', finalY + 'px');
          
          particle.style.animation = `particleExplosion 1s ease-out forwards`;
          particle.style.animationDelay = Math.random() * 0.1 + 's';
          
          // Animation personnalisée pour chaque particule
          particle.animate([
            { transform: 'translate(0, 0) scale(1)', opacity: 1 },
            { transform: `translate(${finalX}px, ${finalY}px) scale(0)`, opacity: 0 }
          ], {
            duration: 1000,
            easing: 'ease-out'
          });
          
          container.appendChild(particle);
        }
        
        document.body.appendChild(container);
        
        setTimeout(() => {
          container.remove();
        }, 1500);
      }
    }

    // ==================== STARS ANIMATION ====================
    class StarsAnimation {
      constructor(canvasId) {
        this.canvas = document.getElementById(canvasId);
        this.ctx = this.canvas.getContext('2d');
        this.stars = [];
        this.init();
      }

      init() {
        this.setupCanvas();
        this.createStars();
        this.animate();
        this.setupResize();
      }

      setupCanvas() {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
      }

      createStars() {
        this.stars = [];
        for(let i = 0; i < CONFIG.STARS_COUNT; i++) {
          this.stars.push({
            x: Math.random() * this.canvas.width,
            y: Math.random() * this.canvas.height,
            size: Math.random() * 2 + 0.3,
            speed: Math.random() * 2 + 0.5,
            opacity: Math.random() * 0.8 + 0.2
          });
        }
      }

      animate() {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        
        for(let star of this.stars) {
          star.y += star.speed;
          
          if(star.y > this.canvas.height) {
            star.y = -5;
            star.x = Math.random() * this.canvas.width;
          }
          
          this.ctx.globalAlpha = star.opacity;
          this.ctx.fillStyle = '#ffffff';
          this.ctx.shadowColor = '#ffffff';
          this.ctx.shadowBlur = 2;
          this.ctx.fillRect(star.x, star.y, star.size, star.size);
        }
        
        requestAnimationFrame(() => this.animate());
      }

      setupResize() {
        window.addEventListener('resize', () => {
          this.setupCanvas();
          this.createStars();
        });
      }
    }

    // ==================== WORDS MANAGEMENT ====================
    class WordsManager {
      constructor() {
        this.dictionary = [];
        this.loadDictionary();
      }

      loadDictionary() {
        this.dictionary = [
          {english: "hello", swahili: "hujambo"},
          {english: "water", swahili: "maji"},
          {english: "fire", swahili: "moto"},
          {english: "house", swahili: "nyumba"},
          {english: "tree", swahili: "mti"},
          {english: "book", swahili: "kitabu"},
          {english: "car", swahili: "gari"},
          {english: "food", swahili: "chakula"},
          {english: "money", swahili: "pesa"},
          {english: "friend", swahili: "rafiki"},
          {english: "school", swahili: "shule"},
          {english: "love", swahili: "upendo"},
          {english: "moon", swahili: "mwezi"},
          {english: "sun", swahili: "jua"},
          {english: "child", swahili: "mtoto"},
          {english: "woman", swahili: "mwanamke"},
          {english: "man", swahili: "mwanaume"},
          {english: "door", swahili: "mlango"},
          {english: "window", swahili: "dirisha"},
          {english: "table", swahili: "meza"},
          {english: "river", swahili: "mto"},
          {english: "mountain", swahili: "mlima"},
          {english: "bird", swahili: "ndege"},
          {english: "fish", swahili: "samaki"},
          {english: "dog", swahili: "mbwa"}
        ];
        
        console.log(`📚 Dictionary loaded: ${this.dictionary.length} words`);
      }

      getRandomPair() {
        return this.dictionary[Math.floor(Math.random() * this.dictionary.length)];
      }

      getRandomPairs(count) {
        const pairs = [];
        const usedIndices = new Set();
        
        while(pairs.length < count && pairs.length < this.dictionary.length) {
          const index = Math.floor(Math.random() * this.dictionary.length);
          if(!usedIndices.has(index)) {
            usedIndices.add(index);
            pairs.push(this.dictionary[index]);
          }
        }
        
        return pairs;
      }
    }

    // ==================== GAME ENGINE ====================
    class GameEngine {
      constructor(masterLanguage) {
        this.masterLanguage = masterLanguage;
        this.wordsManager = new WordsManager();
        this.audioManager = new AudioManager();
        this.fallingWords = new Map(); // number -> {element, text, language, pairId}
        this.activePairs = new Map(); // pairId -> {masterNum, otherNum, wordPair, elements}
        this.usedNumbers = new Set();
        this.nextPairId = 1;
        
        // Selection state: true = waiting for master, false = waiting for translation
        this.waitingForMaster = true;
        this.selectedMasterNumber = null;
        
        this.gameState = {
          score: 0,
          level: 1,
          lives: 3,
          streak: 0,
          speed: 1
        };
        
        this.init();
      }

      init() {
        this.setupKeyboardEvents();
        this.startGameLoop();
        this.updateUI();
        this.updateSelectionIndicator();
        console.log(`🎮 Game engine initialized (${this.masterLanguage} master)`);
      }

      setupKeyboardEvents() {
        document.addEventListener('keydown', (e) => {
          const number = parseInt(e.key);
          if(number >= 1 && number <= 9) {
            this.handleNumberPress(number);
          }
        });
      }

      handleNumberPress(number) {
        if(!this.fallingWords.has(number)) {
          console.log(`❌ No word with number ${number}`);
          return;
        }

        const wordData = this.fallingWords.get(number);
        
        if(this.waitingForMaster) {
          // Premier clic : doit être un mot de la colonne master
          if(wordData.language !== this.masterLanguage) {
            console.log(`❌ Must select ${this.masterLanguage} word first!`);
            this.showWrongColumnError(wordData.element);
            return;
          }
          
          this.selectMasterWord(number);
        } else {
          // Deuxième clic : doit être un mot de l'autre colonne
          if(wordData.language === this.masterLanguage) {
            console.log(`❌ Must select translation word!`);
            this.showWrongColumnError(wordData.element);
            return;
          }
          
          this.selectTranslationWord(number);
        }
      }

      selectMasterWord(number) {
        // Réinitialiser les anciens états
        this.clearAllWordStates();
        
        const wordData = this.fallingWords.get(number);
        this.selectedMasterNumber = number;
        
        // Mettre en état d'attente
        wordData.element.classList.add('waiting-master');
        this.audioManager.playSelectSound();
        
        this.waitingForMaster = false;
        this.updateSelectionIndicator();
        
        console.log(`🎯 Master word selected: ${wordData.text} (${number})`);
      }

      selectTranslationWord(number) {
        const translationData = this.fallingWords.get(number);
        const masterData = this.fallingWords.get(this.selectedMasterNumber);
        
        // Animation de vérification
        translationData.element.classList.add('checking-other');
        
        // Vérifier la correspondance après un court délai pour l'effet visuel
        setTimeout(() => {
          this.checkMatch(this.selectedMasterNumber, number);
        }, 300);
        
        console.log(`🔍 Translation selected: ${translationData.text} (${number})`);
      }

      checkMatch(masterNum, translationNum) {
        // Trouver la paire correspondante
        let matchedPairId = null;
        for(let [pairId, pairData] of this.activePairs.entries()) {
          if((pairData.masterNum === masterNum && pairData.otherNum === translationNum) ||
             (pairData.masterNum === translationNum && pairData.otherNum === masterNum)) {
            matchedPairId = pairId;
            break;
          }
        }

        if(matchedPairId) {
          this.handleCorrectMatch(masterNum, translationNum);
        } else {
          this.handleWrongMatch(masterNum, translationNum);
        }

        // Réinitialiser pour le prochain cycle
        this.waitingForMaster = true;
        this.selectedMasterNumber = null;
        this.updateSelectionIndicator();
      }

      handleCorrectMatch(masterNum, translationNum) {
        const masterWord = this.fallingWords.get(masterNum);
        const translationWord = this.fallingWords.get(translationNum);
        
        console.log(`✅ CORRECT MATCH! ${masterWord.text} ↔ ${translationWord.text}`);
        
        // Effets visuels et sonores
        this.audioManager.playSuccessSound();
        
        masterWord.element.classList.add('matched');
        translationWord.element.classList.add('matched');
        
        // Créer les particules d'explosion
        const masterRect = masterWord.element.getBoundingClientRect();
        const translationRect = translationWord.element.getBoundingClientRect();
        
        VisualEffects.createMatchParticles(
          masterRect.left + masterRect.width / 2,
          masterRect.top + masterRect.height / 2
        );
        
        VisualEffects.createMatchParticles(
          translationRect.left + translationRect.width / 2,
          translationRect.top + translationRect.height / 2
        );
        
        // Mise à jour du score
        this.gameState.score += 10 * this.gameState.level;
        this.gameState.streak += 1;
        
        // Progression de niveau
        if(this.gameState.streak > 0 && this.gameState.streak % 5 === 0) {
          this.gameState.level += 1;
          this.gameState.speed += 0.2;
          console.log(`📈 LEVEL UP! Level ${this.gameState.level}`);
        }
        
        // Nettoyage après animation
        setTimeout(() => {
          this.removeWordPair(masterWord.pairId, masterNum, translationNum);
        }, 1000);
        
        this.updateUI();
      }

      handleWrongMatch(masterNum, translationNum) {
        const masterWord = this.fallingWords.get(masterNum);
        const translationWord = this.fallingWords.get(translationNum);
        
        console.log(`❌ WRONG MATCH! ${masterWord.text} ↔ ${translationWord.text}`);
        
        // Effets d'erreur
        this.audioManager.playErrorSound();
        
        masterWord.element.classList.add('error');
        translationWord.element.classList.add('error');
        
        this.gameState.streak = 0;
        
        // Retirer les états d'erreur après l'animation
        setTimeout(() => {
          this.clearAllWordStates();
        }, 800);
        
        this.updateUI();
      }

      showWrongColumnError(element) {
        element.classList.add('error');
        this.audioManager.playErrorSound();
        
        setTimeout(() => {
          element.classList.remove('error');
        }, 800);
      }

      clearAllWordStates() {
        for(let [number, wordData] of this.fallingWords.entries()) {
          const element = wordData.element;
          element.classList.remove('waiting-master', 'checking-other', 'error');
        }
      }

      updateSelectionIndicator() {
        const indicator = document.getElementById('selection-indicator');
        if(this.waitingForMaster) {
          indicator.textContent = `Next: ${this.masterLanguage.toUpperCase()} word`;
          indicator.style.color = '#00ff41';
        } else {
          const otherLanguage = this.masterLanguage === 'english' ? 'SWAHILI' : 'ENGLISH';
          indicator.textContent = `Next: ${otherLanguage} word`;
          indicator.style.color = '#ffff00';
        }
      }

      getRandomAvailableNumber() {
        let number;
        let attempts = 0;
        do {
          number = Math.floor(Math.random() * 9) + 1;
          attempts++;
        } while(this.usedNumbers.has(number) && attempts < 20);
        
        if(attempts >= 20) {
          // Si tous les numéros sont pris, réutiliser le plus ancien
          const oldestNumber = Math.min(...this.usedNumbers);
          this.usedNumbers.delete(oldestNumber);
          return oldestNumber;
        }
        
        return number;
      }

      spawnWordPair() {
        if(this.activePairs.size >= 4) return; // Limite de paires actives
        
        const wordPair = this.wordsManager.getRandomPair();
        const pairId = this.nextPairId++;
        
        // Obtenir deux numéros différents disponibles
        const masterNum = this.getRandomAvailableNumber();
        this.usedNumbers.add(masterNum);
        
        const otherNum = this.getRandomAvailableNumber();
        this.usedNumbers.add(otherNum);
        
        // Créer les éléments DOM
        const masterWord = this.createFallingWord(
          this.masterLanguage === 'english' ? wordPair.english : wordPair.swahili,
          masterNum,
          'master',
          this.masterLanguage
        );
        
        const otherWord = this.createFallingWord(
          this.masterLanguage === 'english' ? wordPair.swahili : wordPair.english,
          otherNum,
          'other',
          this.masterLanguage === 'english' ? 'swahili' : 'english'
        );
        
        // Stocker les mots individuels
        this.fallingWords.set(masterNum, {
          element: masterWord,
          text: this.masterLanguage === 'english' ? wordPair.english : wordPair.swahili,
          language: this.masterLanguage,
          pairId: pairId
        });
        
        this.fallingWords.set(otherNum, {
          element: otherWord,
          text: this.masterLanguage === 'english' ? wordPair.swahili : wordPair.english,
          language: this.masterLanguage === 'english' ? 'swahili' : 'english',
          pairId: pairId
        });
        
        // Stocker la paire
        this.activePairs.set(pairId, {
          masterNum: masterNum,
          otherNum: otherNum,
          wordPair: wordPair,
          elements: {master: masterWord, other: otherWord}
        });
        
        console.log(`🎯 New pair: ${this.fallingWords.get(masterNum).text}(${masterNum}) ↔ ${this.fallingWords.get(otherNum).text}(${otherNum})`);
      }

      createFallingWord(text, number, column, language) {
        const wordElement = document.createElement('div');
        wordElement.className = `falling-word ${column}-word`;
        
        // Position aléatoire en haut
        const randomX = Math.random() * 60 + 20; // 20% à 80% de largeur
        wordElement.style.left = randomX + '%';
        wordElement.style.top = '-60px';
        
        wordElement.innerHTML = `
          <span class="word-number">${number}</span>
          <span class="word-text">${text}</span>
        `;
        
        // Ajouter à la colonne appropriée
        const targetColumn = column === 'master' ? 
          document.querySelector('#master-column .words-area') :
          document.querySelector('#other-column .words-area');
        
        targetColumn.appendChild(wordElement);
        
        // Animer la chute
        this.animateFallingWord(wordElement, number);
        
        return wordElement;
      }

      animateFallingWord(element, number) {
        let currentTop = -60;
        const speed = this.gameState.speed * 1.2;
        
        const fall = () => {
          // Vérifier si l'élément existe encore
          if(!element.parentNode) return;
          
          currentTop += speed;
          element.style.top = currentTop + 'px';
          
          // Vérifier si le mot a atteint le bas
          if(currentTop > window.innerHeight - 150) {
            this.handleWordMissed(number);
            return;
          }
          
          requestAnimationFrame(fall);
        };
        
        fall();
      }

      handleWordMissed(number) {
        if(!this.fallingWords.has(number)) return;
        
        const wordData = this.fallingWords.get(number);
        const pairId = wordData.pairId;
        
        // Trouver l'autre mot de la paire
        let otherNumber = null;
        for(let [num, data] of this.fallingWords.entries()) {
          if(data.pairId === pairId && num !== number) {
            otherNumber = num;
            break;
          }
        }
        
        // Animer les deux mots comme ratés
        wordData.element.classList.add('error');
        if(otherNumber && this.fallingWords.has(otherNumber)) {
          this.fallingWords.get(otherNumber).element.classList.add('error');
        }
        
        this.gameState.lives -= 1;
        this.gameState.streak = 0;
        
        // Réinitialiser l'état de sélection si nécessaire
        if(this.selectedMasterNumber === number || this.selectedMasterNumber === otherNumber) {
          this.waitingForMaster = true;
          this.selectedMasterNumber = null;
          this.updateSelectionIndicator();
        }
        
        setTimeout(() => {
          this.removeWordPair(pairId, number, otherNumber);
        }, 500);
        
        console.log(`💔 Pair missed: ${wordData.text} (life lost)`);
        this.updateUI();
        
        if(this.gameState.lives <= 0) {
          this.gameOver();
        }
      }

      removeWordPair(pairId, num1, num2) {
        // Supprimer les éléments DOM
        if(this.fallingWords.has(num1)) {
          this.fallingWords.get(num1).element.remove();
          this.fallingWords.delete(num1);
          this.usedNumbers.delete(num1);
        }
        
        if(num2 && this.fallingWords.has(num2)) {
          this.fallingWords.get(num2).element.remove();
          this.fallingWords.delete(num2);
          this.usedNumbers.delete(num2);
        }
        
        // Supprimer la paire
        if(this.activePairs.has(pairId)) {
          this.activePairs.delete(pairId);
        }
      }

      updateUI() {
        document.getElementById('game-score').textContent = this.gameState.score;
        document.getElementById('game-level').textContent = this.gameState.level;
        document.getElementById('game-lives').textContent = this.gameState.lives;
        document.getElementById('game-streak').textContent = this.gameState.streak;
      }

      startGameLoop() {
        // Supprimer les placeholders
        const placeholders = document.querySelectorAll('.words-placeholder');
        placeholders.forEach(p => p.style.display = 'none');
        
        // Générer des mots régulièrement
        this.spawnInterval = setInterval(() => {
          this.spawnWordPair();
        }, Math.max(2000 - (this.gameState.level * 200), 1000)); // Plus rapide à chaque niveau
        
        // Mettre à jour l'intervalle selon le niveau
        setInterval(() => {
          clearInterval(this.spawnInterval);
          this.spawnInterval = setInterval(() => {
            this.spawnWordPair();
          }, Math.max(2000 - (this.gameState.level * 200), 1000));
        }, 10000); // Vérifier toutes les 10 secondes
      }

      gameOver() {
        console.log('🎯 Game Over!');
        clearInterval(this.spawnInterval);
        
        // Arrêter toutes les animations
        for(let [number, wordData] of this.fallingWords.entries()) {
          wordData.element.style.animationPlayState = 'paused';
        }
        
        setTimeout(() => {
          alert(`🎮 Game Over!\n\nFinal Score: ${this.gameState.score}\nLevel Reached: ${this.gameState.level}\nBest Streak: ${this.gameState.streak}`);
          // TODO: Implémenter l'écran de fin de jeu
          location.reload(); // Redémarrer pour l'instant
        }, 1000);
      }
    }

    // ==================== MENU MANAGER ====================
    class MenuManager {
      constructor() {
        this.selectedLanguage = 'english';
        this.init();
      }

      init() {
        this.setupRadioOptions();
        this.setupStartButton();
      }

      setupRadioOptions() {
        const radioOptions = document.querySelectorAll('.radio-option');
        
        radioOptions.forEach(option => {
          option.addEventListener('click', (e) => {
            const value = option.dataset.value;
            this.selectOption(value);
          });
        });
      }

      selectOption(language) {
        const allOptions = document.querySelectorAll('.radio-option');
        allOptions.forEach(option => option.classList.remove('selected'));
        
        const selectedOption = document.querySelector(`[data-value="${language}"]`);
        const radioInput = selectedOption.querySelector('input[type="radio"]');
        
        selectedOption.classList.add('selected');
        radioInput.checked = true;
        this.selectedLanguage = language;
      }

      setupStartButton() {
        const startBtn = document.getElementById('start-game');
        startBtn.addEventListener('click', () => {
          this.startGame();
        });
      }

      startGame() {
        console.log(`🚀 Starting game with ${this.selectedLanguage} as master language`);
        this.transitionToGame();
      }

      transitionToGame() {
        const menu = document.getElementById('main-menu');
        const gameScreen = document.getElementById('game-screen');
        
        // Fade out du menu
        menu.classList.add('fade-out');
        
        setTimeout(() => {
          menu.classList.add('hidden');
          gameScreen.classList.add('active', 'fade-in');
          
          // Mettre à jour les titres des colonnes
          this.updateGameColumns();
          
          // Démarrer le jeu
          window.gameEngine = new GameEngine(this.selectedLanguage);
        }, 500);
      }

      updateGameColumns() {
        const masterTitle = document.getElementById('master-title');
        const otherTitle = document.getElementById('other-title');
        
        if (this.selectedLanguage === 'english') {
          masterTitle.textContent = 'ENGLISH';
          otherTitle.textContent = 'SWAHILI';
        } else {
          masterTitle.textContent = 'SWAHILI';
          otherTitle.textContent = 'ENGLISH';
        }
        
        console.log(`✅ Columns updated: ${this.selectedLanguage} as master`);
      }
    }

    // ==================== INITIALISATION ====================
    document.addEventListener('DOMContentLoaded', function() {
      // Initialiser les étoiles
      const starsAnimation = new StarsAnimation('stars');
      
      // Initialiser le menu
      const menuManager = new MenuManager();
      
      console.log('🎮 ZType Swahili initialized successfully!');
    });
  </script>
</body>
</html>